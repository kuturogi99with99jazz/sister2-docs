// Use DBML to define your database structure
// Schema for Sister 2

Table companies {
  id uuid [pk]
  name text
  status varchar
  created_at timestamptz
  updated_at timestamptz
}

Table branches {
  id uuid [pk]
  company_id uuid
  name text
  status varchar
  created_at timestamptz
  updated_at timestamptz
}

Table divisions {
  id uuid [pk]
  branch_id uuid
  name text
  status varchar
  created_at timestamptz
  updated_at timestamptz
}

Table users {
  id uuid [pk]
  company_id uuid
  email text
  status varchar
  created_at timestamptz
  last_login_at timestamptz
}

Table user_profiles {
  id uuid [pk]
  user_id uuid
  display_name text
  avatar_url text
  timezone text
}

Table roles {
  id uuid [pk]
  name text
  description text
}

Table permissions {
  id uuid [pk]
  name text
  description text
}

Table resources {
  id uuid [pk]
  name text
  description text
}

Table user_roles {
  id uuid [pk]
  user_id uuid
  role_id uuid
}

Table role_permissions {
  id uuid [pk]
  role_id uuid
  permission_id uuid
}

Table permission_resources {
  id uuid [pk]
  permission_id uuid
  resource_id uuid
}

Table work_types {
  id uuid [pk]
  name text
}

Table work_time_types {
  id uuid [pk]
  name text
}

Table works {
  id uuid [pk]
  created_by uuid
  work_type_id uuid
  work_time_type_id uuid
  template_id uuid
  title text
  content text
  form_data_json jsonb
  status varchar
  start_date_planned date
  end_date_planned date
  start_date_actual date
  end_date_actual date
  created_at timestamptz
  updated_at timestamptz
}

Table work_assignees {
  id uuid [pk]
  work_id uuid
  user_id uuid
  is_primary boolean
}

Table work_activity_logs {
  id uuid [pk]
  work_id uuid
  user_id uuid
  action varchar
  meta_json jsonb
  created_at timestamptz
}

Table work_tags {
  id uuid [pk]
  name text
}

Table work_tag_links {
  id uuid [pk]
  work_id uuid
  tag_id uuid
}

Table announcements {
  id uuid [pk]
  title text
  body text
  link_url text
  priority varchar
  start_at timestamptz
  end_at timestamptz
  created_by uuid
  created_at timestamptz
  updated_at timestamptz
}

Table announcement_targets {
  id uuid [pk]
  announcement_id uuid
  target_scope varchar
  target_id uuid
}

Table announcement_reads {
  id uuid [pk]
  announcement_id uuid
  user_id uuid
  dismissed_at timestamptz
}

Table screen_routes {
  id uuid [pk]
  route_path text
  name text
  description text
  is_active boolean
  created_at timestamptz
  updated_at timestamptz
}

Table screen_feedback_templates {
  id uuid [pk]
  label text
  is_active boolean
  created_at timestamptz
  updated_at timestamptz
}

Table screen_feedbacks {
  id uuid [pk]
  screen_route_id uuid
  user_id uuid
  rating varchar
  reason text
  template_id uuid
  created_at timestamptz
  updated_at timestamptz
}

Table screen_feedback_logs {
  id uuid [pk]
  feedback_id uuid
  user_id uuid
  action varchar
  before_json jsonb
  after_json jsonb
  created_at timestamptz
}

Table report_templates {
  id uuid [pk]
  name text
  report_type varchar
  output_formats text[]
  template_file_key text
  template_file_name text
  retention_days int
  is_immutable boolean
  status varchar
  created_by uuid
  created_at timestamptz
  updated_at timestamptz
}

Table report_template_roles {
  id uuid [pk]
  report_template_id uuid
  role_id uuid
  access_type varchar
}

Table report_runs {
  id uuid [pk]
  report_template_id uuid
  triggered_by uuid
  trigger_type varchar
  parameters_json jsonb
  status varchar
  started_at timestamptz
  finished_at timestamptz
  created_at timestamptz
}

Table report_run_files {
  id uuid [pk]
  report_run_id uuid
  file_key text
  file_name text
  content_type text
  size_bytes bigint
  created_at timestamptz
}

Table report_schedules {
  id uuid [pk]
  report_template_id uuid
  cron text
  timezone text
  is_active boolean
  last_run_at timestamptz
  next_run_at timestamptz
  created_at timestamptz
  updated_at timestamptz
}

Table work_targets {
  id uuid [pk]
  target_type varchar
  name text
  description text
  owner_user_id uuid
  status varchar
  created_at timestamptz
  updated_at timestamptz
}

Table work_target_links {
  id uuid [pk]
  work_id uuid
  target_id uuid
}

Table blog_posts {
  id uuid [pk]
  author_user_id uuid
  title text
  status varchar
  published_at timestamptz
}

Table blog_tags {
  id uuid [pk]
  name text
}

Table blog_categories {
  id uuid [pk]
  name text
}

Table blog_post_tags {
  id uuid [pk]
  post_id uuid
  tag_id uuid
}

Table blog_post_categories {
  id uuid [pk]
  post_id uuid
  category_id uuid
}

Table blog_work_links {
  id uuid [pk]
  post_id uuid
  work_id uuid
}

Table blog_target_links {
  id uuid [pk]
  post_id uuid
  target_id uuid
}

Table audit_logs {
  id uuid [pk]
  user_id uuid
  action varchar
  resource_type varchar
  resource_id uuid
  created_at timestamptz
}

Table system_settings {
  id uuid [pk]
  key varchar
  value_json jsonb
  is_active boolean
  updated_by uuid
  updated_at timestamptz
}

Table company_settings {
  id uuid [pk]
  company_id uuid
  key varchar
  value_json jsonb
  is_active boolean
  updated_by uuid
  updated_at timestamptz
}

Table chat_threads {
  id uuid [pk]
  scope_type varchar
  scope_id uuid
  title text
  created_by uuid
  created_at timestamptz
}

Table chat_messages {
  id uuid [pk]
  chat_id uuid
  sender_user_id uuid
  content text
  message_type varchar
  parent_message_id uuid
  created_at timestamptz
}

Table chat_members {
  id uuid [pk]
  chat_id uuid
  user_id uuid
  role varchar
  joined_at timestamptz
}

Table chat_reads {
  id uuid [pk]
  chat_id uuid
  user_id uuid
  last_read_message_id uuid
  last_read_at timestamptz
}

Table chat_attachments {
  id uuid [pk]
  message_id uuid
  uploaded_by uuid
  file_key text
  file_name text
  content_type text
  size_bytes bigint
}

Table internal_tools {
  id uuid [pk]
  owner_user_id uuid
  name text
  type varchar
  status varchar
  created_at timestamptz
  updated_at timestamptz
}

Table tool_definitions {
  id uuid [pk]
  tool_id uuid
  definition_json jsonb
  version varchar
  created_at timestamptz
}

Table tool_entries {
  id uuid [pk]
  tool_id uuid
  submitter_user_id uuid
  status varchar
  payload_json jsonb
  created_at timestamptz
  updated_at timestamptz
}

Table tool_entry_approvals {
  id uuid [pk]
  entry_id uuid
  approver_user_id uuid
  step int
  status varchar
  comment text
  created_at timestamptz
}

Table tool_attachments {
  id uuid [pk]
  entry_id uuid
  uploaded_by uuid
  file_key text
  file_name text
  content_type text
  size_bytes bigint
}

Ref: companies.id < branches.company_id
Ref: branches.id < divisions.branch_id
Ref: companies.id < users.company_id
Ref: users.id < user_profiles.user_id

Ref: users.id < user_roles.user_id
Ref: roles.id < user_roles.role_id
Ref: roles.id < role_permissions.role_id
Ref: permissions.id < role_permissions.permission_id
Ref: permissions.id < permission_resources.permission_id
Ref: resources.id < permission_resources.resource_id

Ref: work_types.id < works.work_type_id
Ref: work_time_types.id < works.work_time_type_id
Ref: users.id < works.created_by

Ref: works.id < work_assignees.work_id
Ref: users.id < work_assignees.user_id
Ref: works.id < work_activity_logs.work_id
Ref: users.id < work_activity_logs.user_id

Ref: works.id < work_tag_links.work_id
Ref: work_tags.id < work_tag_links.tag_id

Ref: users.id < announcements.created_by
Ref: announcements.id < announcement_targets.announcement_id
Ref: announcements.id < announcement_reads.announcement_id
Ref: users.id < announcement_reads.user_id

Ref: screen_routes.id < screen_feedbacks.screen_route_id
Ref: users.id < screen_feedbacks.user_id
Ref: screen_feedback_templates.id < screen_feedbacks.template_id
Ref: screen_feedbacks.id < screen_feedback_logs.feedback_id
Ref: users.id < screen_feedback_logs.user_id

Ref: users.id < report_templates.created_by
Ref: report_templates.id < report_template_roles.report_template_id
Ref: roles.id < report_template_roles.role_id
Ref: report_templates.id < report_runs.report_template_id
Ref: users.id < report_runs.triggered_by
Ref: report_runs.id < report_run_files.report_run_id
Ref: report_templates.id < report_schedules.report_template_id

Ref: work_targets.id < work_target_links.target_id
Ref: works.id < work_target_links.work_id
Ref: users.id < work_targets.owner_user_id

Ref: blog_posts.id < blog_post_tags.post_id
Ref: blog_tags.id < blog_post_tags.tag_id
Ref: blog_posts.id < blog_post_categories.post_id
Ref: blog_categories.id < blog_post_categories.category_id
Ref: blog_posts.id < blog_work_links.post_id
Ref: works.id < blog_work_links.work_id
Ref: blog_posts.id < blog_target_links.post_id
Ref: work_targets.id < blog_target_links.target_id

Ref: users.id < audit_logs.user_id
Ref: users.id < system_settings.updated_by
Ref: users.id < company_settings.updated_by
Ref: companies.id < company_settings.company_id

Ref: chat_threads.id < chat_messages.chat_id
Ref: chat_threads.id < chat_members.chat_id
Ref: users.id < chat_members.user_id
Ref: chat_threads.id < chat_reads.chat_id
Ref: users.id < chat_reads.user_id
Ref: chat_messages.id < chat_attachments.message_id
Ref: users.id < chat_attachments.uploaded_by

Ref: internal_tools.id < tool_definitions.tool_id
Ref: internal_tools.id < tool_entries.tool_id
Ref: tool_entries.id < tool_entry_approvals.entry_id
Ref: users.id < tool_entry_approvals.approver_user_id
Ref: tool_entries.id < tool_attachments.entry_id
Ref: users.id < tool_entries.submitter_user_id
Ref: users.id < internal_tools.owner_user_id
Ref: tool_definitions.id < works.template_id
