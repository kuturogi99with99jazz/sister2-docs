# 📗 Sister 2 要件定義書

## 1. システム概要

Sister 2は、既存のプロジェクト進捗管理システムをモダンアーキテクチャで再構築することを目的としています。  
目的は「低コスト・高拡張性・高可用性」を両立し、将来的なAI連携・自動化に対応できる設計を採用します。

### 1.1 追加検討事項

- 想定ユーザー規模
  - 同時接続数: 10-100
  - 総ユーザー数: 30-300
  - 組織数: 1-10

---

## 2. 目的・背景

| 項目 | 内容 |
|------|------|
| 現状の課題 | サーバ運用負荷、保守コスト、可視化不足 |
| 解決方針 | サーバレス構成（AWS Lambda / Fargate）化、CI/CD導入、AI連携 |
| 目的 | 継続的な改善と低コスト運用を実現する基盤構築 |

- KPI目標値
  - MAU: 100以上
  - DAU: 20以上
  - アクティブ組織数: 5以上
  - タスク完了リードタイム中央値: 3日以内
  - 可用性: 99.9%以上
  - 月額コスト: 50ドル以下

---

## 3. スコープ（対象/非対象）

- 対象: 現行Sisterの主要機能（プロジェクト管理、タスク管理、ナレッジ管理、通知、ファイル管理、分析、認証・認可）の再構築
- 対象: 管理業務（マスタ管理、システム設定管理）
- 対象: チャット機能、社内ツール（定義駆動型）の追加
- 非対象: 現行Sisterのソフトウェア開発報告書チェックツールは社内ツールに吸収するので対象外、現行AI分析も対象外

---

## 4. 機能要件

MVP範囲（必須/後回し）の機能優先度は本章の上から順とする。

### 4.1 プロジェクト管理

プロジェクトの一覧、登録、編集、削除を提供し、進捗・担当者・日付を管理できること。  
一覧画面では、サマリー（Total/Completed/In Progress）とカード一覧を表示し、ステータス・担当者・日付範囲・タグで絞り込みできること。  
一覧では「Show Filters」「Create New Project」を主要アクションとして提供すること。  
カードはID、名称、説明、ステータス、計画/実績日付、タスク数、PIC数を表示すること。  
詳細画面はプロジェクト概要・タスク一覧・Ganttを表示できること。  
添付はUpload/Downloadに対応し、編集は管理者または作成者が実行できること。  
プロジェクト代表画像を任意で設定でき、作成/更新/削除の監査ログを記録すること。

登録/編集時は project_id, company_id, branch_id, division_id, name, start_date_planned, end_date_planned を必須とし、description, start_date_actual, end_date_actual は任意とする。

#### 4.1.1 追加検討事項

- [Open Question] project_idの採番ルール（手動/自動/重複可否）
- [Assumption] 会社/拠点/部門のマスタ管理方針は 4.9 で定義
- [Open Question] Completed/In Progressの判定条件（ステータス/日付）
- [Risk] 実績日付が未入力のプロジェクト表示ルールが未定義

---

### 4.2 タスク管理

タスクの一覧、登録、編集、削除を提供し、ステータス・期日・担当者を追跡できること。  
一覧画面では、サマリー（Total/Completed/In Progress）とリストを表示し、プロジェクト・担当者・ステータス・タグ・日付で絞り込みできること。  
一覧では「Show Filters」「Create New Task」を主要アクションとして提供すること。  
インポート/エクスポート（Upload/Download）に対応すること。  
リストはステータス、タイトル、計画/実績日付、担当者、タグを表示すること。  
詳細画面ではタスク本文、コメント数、稼働時間、履歴を確認できること。  
タグは複数付与でき、色付きラベルで表示されること。  
作成/更新/削除およびステータス変更の監査ログを記録すること。

登録/編集時は task_id, user_id, project_id, title, content, start_date_planned, end_date_planned, status を必須とし、start_date_actual, end_date_actual, hours_worked, tags は任意とする。

#### 4.2.1 追加検討事項

- [Assumption] statusの値域: Not Started / In Progress / Completed / On Hold / Cancelled
- [Assumption] hours_workedは手動入力のみ
- [Assumption] タグはマスタ管理（4.9参照）
- [Risk] タスク一括アップロード時のバリデーション/重複処理が未定義

---

### 4.3 ナレッジ管理

記事の投稿とドラフト管理を提供し、タグ付けとAI要約を行えること。  
公開/下書きの状態を扱い、検索・整理に必要なメタ情報を保持できること。  
記事はタイトル、本文、カテゴリ、タグ、作成者、公開日時を管理できること。  
下書きは作成者のみ編集でき、公開後は権限に応じて編集/非公開にできること。  
記事にはプロジェクト/タスクへの関連付けを行えること。  
AI要約は本文を基に生成し、要約結果を人が編集できること。  
記事は全文検索でき、タグ/カテゴリ/作成者/期間で絞り込みできること。

#### 4.3.1 追加検討事項

- [Open Question] AI要約の生成タイミング（保存時/公開時/手動実行）
- [Open Question] 記事の閲覧権限（組織内公開/プロジェクト限定）
- [Risk] AI要約の品質評価と手動修正フローが未定義

---

### 4.4 通知機能

タスク完了・期限アラートなどの通知を送信できること。  
通知チャネルはメール等を中心に運用できること。  
通知はイベント種別（作成/更新/期限/メンション/承認）を識別できること。  
通知の受信可否はユーザー単位で設定できること。  
通知には対象リソース（プロジェクト/タスク/チャット/社内ツール）へのリンク情報を含めること。  
通知送信の失敗は再送または管理者向けにエスカレーションできること。

#### 4.4.1 追加検討事項

- [Open Question] 通知頻度の集約ルール（即時/日次/週次）
- [Open Question] ユーザー単位の通知設定の初期値

---

### 4.5 ファイル管理

ファイルのアップロード/ダウンロードを提供し、署名付きURLを発行できること。  
ファイルはプロジェクト/タスク/チャット/社内ツール等の関連リソースに紐づけられること。

---

### 4.6 分析機能

進捗率と稼働時間を可視化できること。  
定期的に集計結果を更新できること。  
プロジェクト単位/担当者単位/期間単位で集計を確認できること。  
集計結果はダッシュボード上で表示し、CSVなどでエクスポートできること。  
集計に利用した算出条件（期間、対象範囲、除外条件）を記録できること。

#### 4.6.1 追加検討事項

- [Open Question] 進捗率の算出ロジック（タスク完了比率/工数比率）
- [Open Question] 稼働時間の計測方法（手入力/タイムトラッキング）

---

### 4.7 社内ツール

定期作業・雑務のシステム化と属人化解消を目的とし、定義駆動（フォーム/ワークフロー/集計）で運用できること。  
対象業務は申請、報告、チェックリスト、集計業務とし、管理者のみが定義を編集できること。  
定義は公開/下書きの状態管理を持ち、定義ベースの型・必須・範囲チェックによる入力検証を行うこと。  
承認フローは2段階の承認に対応し、申請/承認/差戻し通知を送信できること。  
RBACによりツール単位で閲覧/操作を制御し、定義変更・申請・承認の履歴を記録すること。  
保存期間は最大1年を想定する。

- [Open Question] 既存Excel移行方針: [Suggestion] 重要帳票から優先移行、テンプレート化で段階移行
- [Assumption] ステータス遷移: draft → submitted → approved / rejected → resubmitted → cancelled
- [Assumption] 承認確定条件: step1 と step2 の両方通過で approved 確定

#### 4.7.1 追加検討事項

- [Open Question] 承認者割当ルール（step1/step2のロール紐付け）
- [Open Question] resubmitted時の取り扱い（履歴保持/再承認条件）
- [Risk] 定義変更と既存申請データの整合ルールが未定義

---

### 4.8 チャット機能

プロジェクト/タスク単位の進捗共有と意思決定の記録を簡易化できること。  
対象スコープはプロジェクト単位/タスク単位とし、参加者は当該プロジェクト/タスクに所属するメンバーとする。  
削除は投稿者と管理者に限定し、閲覧/投稿はRBACに準拠すること。  
メッセージ種別はテキスト/ファイル/システム通知を扱い、スレッド＋時系列の構造を持つこと。  
新着/メンション/期限関連の通知を送信し、S3署名URLで安全に添付を扱えること。  
送信・編集・削除は監査ログに記録し、保存期間は最大1年を想定する。  
UX要件として既読/未読、検索、メンション、簡易リアクションを提供する。

#### 4.8.1 追加検討事項

- [Open Question] systemメッセージの生成主体と投稿制限（サーバのみ/管理者のみ）
- [Open Question] chat_members.role の値域（owner/moderator/member など）
- [Open Question] 既読/未読の表示単位（スレッド/メッセージ）
- [Risk] 保存期間1年の根拠（法務/監査要件）の確認が必要

---

### 4.9 管理業務

管理者がシステム運用に必要なマスタと設定を管理できること。  
管理業務の操作は監査ログに記録し、編集権限は管理者ロールに限定すること。  
設定変更は履歴を保持し、差分表示ができること。

#### 4.9.1 マスタ管理機能

以下のマスタを必須とすること：ユーザー、会社、拠点、部門、ロール、リソース、パーミッション、タグ、カテゴリ。  
マスタは一覧/検索/登録/編集/削除に対応すること。  
参照先が存在するマスタは削除ではなく無効化（アーカイブ）を優先できること。  
マスタ変更時に影響範囲（関連プロジェクト/タスク/記事）を表示できること。  
CSV等による一括登録/更新に対応できること。

- [Open Question] マスタ変更の反映タイミング（即時/バッチ）
- [Risk] マスタ変更が既存レポートや集計ロジックに影響する可能性

#### 4.9.2 システム設定管理機能

システム全体共通の設定と組織単位の設定を管理できること。  
設定は有効化/無効化の切替に対応し、誤操作を防止すること。  
重要設定の変更は保存前に確認を行えること。

- [Open Question] 設定の優先順位（全体共通 vs 組織単位）
- [Open Question] 設定の対象範囲（通知、権限ポリシー、保持期間など）

## 5. 非機能要件

| 分類 | 内容 |
|------|------|
| 可用性 | 99.9%以上（AWS SLA基準） |
| 拡張性 | サーバレス構成で自動スケール |
| 保守性 | GitHub Actionsによる自動CI/CD |
| ログ | CloudWatch + S3保存 |
| 通知 | SES/SNSで障害・完了通知 |
| コスト | 月額50ドル以下を目標 |

### 5.1 追加検討事項

- [Open Question] 性能要件（レスポンスタイム/スループット）
- [Assumption] 想定ユーザー規模に基づき性能要件を定義（同時接続数10-100、総ユーザー数30-300、組織数1-10）
- [Open Question] SLO/SLI定義（測定対象と基準）
- [Open Question] RTO/RPO（障害復旧/データ復旧）
- [Risk] $50目標の前提（ユーザー数/利用量）が未記載

---

## 6. セキュリティ・認証要件

| 項目 | 内容 |
|------|------|
| 認証 | AWS Cognito（JWT管理） |
| 認可 | Cognito + RBAC（ユーザー権限管理） |
| 通信 | HTTPS / JWT / IAM最小権限 |

### 6.1 追加検討事項

- [Open Question] RBACのロール一覧と権限マトリクス
- [Open Question] 監査ログの保持期間/閲覧権限
- [Risk] PII/機微情報の扱い（暗号化/マスキング）が未定義

---

## 7. データ連携・外部連携

| 区分 | 内容 |
|------|------|
| 外部AI連携 | OpenAI APIを利用し、要約／提案生成 |
| 外部通知 | AWS SES/SNSによるメール・Push通知 |
| ファイル署名 | S3署名URLによる安全なダウンロード／アップロード |

### 7.1 追加検討事項

- [Open Question] OpenAIへ送信するデータ範囲（マスキング有無）
- [Risk] 外部AI送信データの取り扱いポリシー未定義

---

## 8. 移行要件

- 認証はGo LiveでCognitoへ一括切り替え（既存ユーザー移行を含む）

### 8.1 追加検討事項

- [Open Question] 既存ユーザー移行手順（ID連携/パスワードリセット）
- [Risk] Go Live一括切替の影響範囲/許容ダウンタイム

---

## 9. リスク・対策

| リスク | 対策 |
|--------|------|
| AWS課金増大 | 無料枠を最大活用、リソース監視 |
| OpenAI API利用制限 | キャッシュ・バッチ処理併用 |
| Neon接続制限 | プーリング／Fargate側で制御 |
| 認証管理複雑化 | Cognito Hosted UI採用 |

### 9.1 追加検討事項

- [Open Question] チャット/社内ツール利用拡大時の課金増対策

---

## 10. 成果物一覧

| 種別 | ファイル名 | 備考 |
|------|-------------|------|
| 提案資料 | proposal.md | アーキテクチャ概要 |
| 要件定義書 | requirements.md | 本書 |
| 設計書 | architecture.md | インフラ・構成詳細 |
| ER図 | er_diagram.mmd | DB構造 |
| API仕様書 | api_spec.md | OpenAPI準拠 |

### 10.1 追加検討事項

- [Open Question] ER図/API仕様の更新ルール（版管理/レビュー手順）

---

## 11. 今後の課題

- RBAC設計の詳細化  
- AI要約プロンプト最適化  
- Fargateジョブスケジュール管理の具体化  
- コスト試算の再精査  

### 11.1 追加検討事項

- [Open Question] 課題の優先順位と期限

---

## 12. スケジュール（初期案）

| フェーズ | 期間 | 内容 |
|-----------|------|------|
| 要件定義 | 〜2026/01 | 各機能整理・レビュー |
| PoC構築 | 2026/01〜03 | サーバレス＋Neon動作検証 |
| 実装 | 2026/04〜07 | 本実装・UIデザイン刷新 |
| テスト | 2026/08〜09 | 自動・手動検証 |
| リリース | 2026/10 | 運用開始 |

### 12.1 追加検討事項

- [Risk] 人員/担当範囲の前提が未記載で実現性評価が困難
  - [Assumption] 担当: 1名
  - [Assumption] 担当範囲: 全て
  - [Assumption] 経験: 要件定義〜実装・テスト・運用・保守まで20年以上
  - [Assumption] 備考: 個人開発で年2〜3アプリ（自作・自分用）を継続
  - [Suggestion] 1名体制に合わせて各フェーズ期間の再見積もりとバッファ確保を行う
  - [Suggestion] 実装フェーズはMVP必須機能に範囲を絞り、段階リリースを前提に再整理する
