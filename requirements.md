# 📗 Sister 2 要件定義書

## 1. システム概要

Sister 2は、既存のプロジェクト進捗管理システムを、**Work（仕事）中心モデル**として再構築することを目的とします。  
管理の最小単位を「プロジェクト」ではなく「人が日々行うWork」とし、開発・運用・保守・定期作業・突発対応を一元的に扱います。

### 1.2 ドキュメント/モックUI公開方針

- [Assumption] 公開先は GitHub Pages とし、`sister2-docs` リポジトリから配信する
- [Assumption] 公開URLは `https://kuturogi99with99jazz.github.io/sister2-docs/mockui/` を基準とする
- [Assumption] mockui は静的ビルド成果物として出力され、Pages から配信可能である
- [Suggestion] 将来の拡張（`/docs` など）を見据え、mockui はサブディレクトリ `/mockui` で公開する
- [Assumption] mockui は `mock_ui/` 配下の静的HTML/CSSとして管理し、GitHub Pages は `mock_ui/` を公開ディレクトリとして扱う
- [Risk] サブパス配信のため、SvelteKit 等は `paths.base` 等の設定が必要になる可能性がある

### 1.1 追加検討事項

- 想定ユーザー規模
  - 同時接続数: 10-100
  - 総ユーザー数: 30-300
  - 組織数: 1-10

---

## 2. 目的・背景

| 項目 | 内容 |
|------|------|
| 現状の課題 | 業務構造とデータ構造の乖離、運用/保守の可視化不足、工数入力負荷 |
| 解決方針 | Workを最小単位として定義し、操作ログから稼働を推定する |
| 目的 | 実態に即した業務管理と、将来的なAI活用に耐える基盤構築 |

- KPI目標値
  - MAU: 100以上
  - DAU: 20以上
  - アクティブ組織数: 5以上
  - Work完了リードタイム中央値: 3日以内
  - 可用性: 99.9%以上
  - 月額コスト: 50ドル以下

---

## 3. スコープ（対象/非対象）

- 対象: Work管理、Work対象（プロジェクト/システム/共通業務）管理、ナレッジ管理、通知、ファイル管理、分析、認証・認可
- 対象: 管理業務（マスタ管理、システム設定管理）
- 対象: チャット機能、社内ツール（定義駆動型）
- 非対象: 現行Sisterのソフトウェア開発報告書チェックツールは社内ツールに吸収するので対象外、現行AI分析も対象外

---

## 4. 機能要件

MVP範囲（必須/後回し）の機能優先度は本章の上から順とする。

### 4.1 Work管理（コア）

Workの一覧、登録、編集、削除を提供し、ステータス・期日・担当者・対象を追跡できること。  
一覧画面では、サマリー（Total/Completed/In Progress）とリストを表示し、対象・担当者・ステータス・タグ・日付で絞り込みできること。  
一覧では「Show Filters」「Create New Work」を主要アクションとして提供すること。  
リストはステータス、タイトル、計画/実績日付、担当者、対象、タグを表示すること。  
詳細画面ではWork本文、コメント数、推定稼働時間、履歴を確認できること。  
タグは複数付与でき、色付きラベルで表示されること。  
作成/更新/削除およびステータス変更の監査ログを記録すること。

登録/編集時は work_id, created_by, title, content, status, start_date_planned, end_date_planned を必須とし、start_date_actual, end_date_actual, tags は任意とする。  
Workは複数人担当を許容し、責任者（PIC）を明示できること。
Workは他のWorkと関連付けでき、関連の追加/削除を手動で行えること。
関連は関係タイプを持たない参照リンクとし、双方向に表示されること。
関連Workの解除（削除）がUIから実行できること。

共通ヘッダを主要画面に表示し、以下を含めること。  
- グローバルナビ（主要機能への導線）  
- タブレット/スマホではハンバーガーメニューを主要導線として提供すること  
- 右端にユーザー表示（アバター）とユーザーメニューを配置すること  
- ユーザーメニューにはユーザー名、プロフィール、設定、ログアウトを含めること  
- 通知アイコンを右端に配置し、未読数を視認できること

#### 4.1.1 追加検討事項

- [Assumption] statusの値域: Not Started / In Progress / Completed / On Hold / Cancelled
- [Open Question] Work完了判定条件（ステータス/日付/レビュー）
- [Risk] 一括アップロード時のバリデーション/重複処理が未定義
- [Assumption] 関連Workの関係タイプ（依存/重複など）は将来検討とする

---

### 4.2 Work分類（業務の性質・時間特性）

Workを以下の軸で分類し、検索・集計に利用できること。  
- 業務の性質（開発／運用／保守／障害対応 等）  
- 時間的特性（単発／定期／突発）

分類はマスタ管理とし、管理者のみが追加/編集できること。

#### 4.2.1 追加検討事項

- [Assumption] 分類は `work_type` / `work_time_type` の2軸で管理
- [Open Question] 分類の初期セットと廃止ルール

---

### 4.3 Work対象（ターゲット）管理

Workが紐づく「対象」を以下の種別として管理できること。  
- システム  
- プロジェクト  
- 共通業務（会社/部門/横断業務など）

Workは対象への紐付けが任意であり、複数対象への紐付けを許容すること。  
プロジェクトおよびシステムは、Workが紐づく「対象の一種」として扱うこと。

#### 4.3.1 追加検討事項

- [Open Question] 対象の粒度（システム/サブシステム/モジュール）
- [Open Question] 共通業務の表現方法（対象テーブル/タグ/階層）

---

### 4.4 操作ログと稼働時間（自動算出）

Workの開始・完了・更新などの操作ログを記録できること。  
工数は別途入力させるのではなく、操作ログをもとに自動的に算出できること。  
正確な時間入力を強制せず、担当者の業務負荷を増やさない運用を前提とすること。
操作ログは WorkLog として管理し、開始/完了などの行為を蓄積できること。

#### 4.4.1 追加検討事項

- [Open Question] 稼働時間の算出ルール（開始/停止の定義、放置時間の扱い）
- [Open Question] 並行作業の扱い（重複除外/重み付け）
- [Risk] 自動算出と実態乖離時の補正フローが未定義
- [Assumption] 操作ログから算出した稼働時間は初期値とし、ユーザーが任意に手動補正できること

---

### 4.5 ナレッジ管理

記事の投稿とドラフト管理を提供し、タグ付けとAI要約を行えること。  
公開/下書きの状態を扱い、検索・整理に必要なメタ情報を保持できること。  
記事はタイトル、本文、カテゴリ、タグ、作成者、公開日時を管理できること。  
下書きは作成者のみ編集でき、公開後は権限に応じて編集/非公開にできること。  
記事に添付資料（PDF/画像/スプレッドシート等）を紐付けできること。  
記事にはWork/対象への関連付けを行えること。  
AI要約は本文を基に生成し、要約結果を人が編集できること。  
記事は全文検索でき、タグ/カテゴリ/作成者/期間で絞り込みできること。
記事公開は原則即時公開とし、重要カテゴリは承認必須とする。  

#### 4.5.1 追加検討事項

- [Open Question] AI要約の生成タイミング（保存時/公開時/手動実行）
- [Open Question] 記事の閲覧権限（組織内公開/対象限定）
- [Assumption] 記事公開は即時公開が基本だが、重要カテゴリは承認必須
- [Assumption] 重要カテゴリの例: セキュリティ/監査/障害対応/個人情報/法務・契約
- [Risk] AI要約の品質評価と手動修正フローが未定義

---

### 4.6 通知機能

Work完了・期限アラートなどの通知を送信できること。  
通知チャネルはメール等を中心に運用できること。  
通知はイベント種別（作成/更新/期限/メンション/承認）を識別できること。  
通知の受信可否はユーザー単位で設定できること。  
通知には対象リソース（Work/対象/チャット/社内ツール）へのリンク情報を含めること。  
通知送信の失敗は再送または管理者向けにエスカレーションできること。

#### 4.6.1 追加検討事項

- [Open Question] 通知頻度の集約ルール（即時/日次/週次）
- [Open Question] ユーザー単位の通知設定の初期値

---

### 4.7 ファイル管理

ファイルのアップロード/ダウンロードを提供し、署名付きURLを発行できること。  
ファイルはWork/対象/チャット/社内ツール等の関連リソースに紐づけられること。

---

### 4.8 分析機能

進捗率と稼働時間を可視化できること。  
定期的に集計結果を更新できること。  
Work対象単位/担当者単位/期間単位で集計を確認できること。  
集計結果はダッシュボード上で表示し、CSVなどでエクスポートできること。  
集計に利用した算出条件（期間、対象範囲、除外条件）を記録できること。

#### 4.8.1 追加検討事項

- [Open Question] 進捗率の算出ロジック（Work完了比率/稼働比率）
- [Open Question] 稼働時間の計測方法（操作ログのみ/補正入力）

---

### 4.9 社内ツール

定期作業・雑務のシステム化と属人化解消を目的とし、定義駆動（フォーム/ワークフロー/集計）で運用できること。  
対象業務は申請、報告、チェックリスト、集計業務とし、管理者のみが定義を編集できること。  

---

### 4.10 画面評価（Good/Bad）

ユーザーは画面単位でGood/Badの評価を付与できること。  
評価対象の画面はルート単位とし、例として `/work` を含むこと。  
評価は公開とし、画面ごとの集計（Good率/Bad率/件数）を表示できること。  
評価には理由（任意）を付与でき、理由は最大400文字とすること。  
理由は任意入力に加え、テンプレート選択を利用できること。  
同一ユーザーは同一画面に対して最新の評価1件のみ保持し、再評価で上書きできること。  
評価の変更履歴を監査ログとして記録できること。  
評価集計は分析機能の指標として利用できること。  

#### 4.10.1 追加検討事項

- [Open Question] テンプレート文言の初期セットと管理方法
- [Assumption] 画面一覧はルートの静的定義で管理する
- [Assumption] 集計の更新タイミングは即時のみとする

---

### 4.11 帳票（Reports）

ユーザーは帳票を手動または定期バッチで生成できること。  
帳票の対象は Work集計 / 勤怠 / 稼働 / ナレッジ一覧を必須とする。  
帳票の出力形式は Excel（.xlsx）および PDF を扱えること。  
帳票テンプレートは差し替え可能であること。  
帳票ごとに閲覧/生成の権限を設定できること。  
帳票ごとに保存期間と改ざん防止要件を設定できること。  
生成結果は固定スナップショットとして保存できること。  

#### 4.11.1 追加検討事項

- [Open Question] 帳票テンプレートの管理方法（管理画面/ファイル管理/バージョン付与）
- [Open Question] PDFの生成方針（Excel変換/専用テンプレ）
- [Open Question] 定期バッチのスケジュール粒度（日次/週次/月次）
定義は公開/下書きの状態管理を持ち、定義ベースの型・必須・範囲チェックによる入力検証を行うこと。  
承認フローは2段階の承認に対応し、申請/承認/差戻し通知を送信できること。  
RBACによりツール単位で閲覧/操作を制御し、定義変更・申請・承認の履歴を記録すること。  
保存期間は最大1年を想定する。

#### 4.9.1 定義駆動テンプレート（ToolTemplate）

社内ツールの定義は ToolTemplate として管理し、Work生成の起点として扱うこと。  
ToolTemplateは form_schema / workflow_schema を保持し、Workの入力項目とフローを規定できること。  
Workは template_id と form_data（JSON）を保持し、業務追加時のDBスキーマ拡張を不要とすること。

ToolTemplateに含める項目（要件レベル）:
- id / name / work_type / target_type
- form_schema（JSON）
- workflow_schema（JSON）
- enabled

Work.form_data は ToolTemplate の form_schema に準拠すること。

- [Open Question] 既存Excel移行方針: [Suggestion] 重要帳票から優先移行、テンプレート化で段階移行
- [Assumption] ステータス遷移: draft → submitted → approved / rejected → resubmitted → cancelled
- [Assumption] 承認確定条件: step1 と step2 の両方通過で approved 確定

#### 4.9.2 追加検討事項

- [Open Question] 承認者割当ルール（step1/step2のロール紐付け）
- [Open Question] resubmitted時の取り扱い（履歴保持/再承認条件）
- [Risk] 定義変更と既存申請データの整合ルールが未定義

---

### 4.10 チャット機能

Work単位の進捗共有と意思決定の記録を簡易化できること。  
対象スコープはWork単位を基本とし、必要に応じて対象（プロジェクト/システム）単位のスレッドも扱えること。  
削除は投稿者と管理者に限定し、閲覧/投稿はRBACに準拠すること。  
メッセージ種別はテキスト/ファイル/システム通知を扱い、スレッド＋時系列の構造を持つこと。  
新着/メンション/期限関連の通知を送信し、S3署名URLで安全に添付を扱えること。  
送信・編集・削除は監査ログに記録し、保存期間は最大1年を想定する。  
UX要件として既読/未読、検索、メンション、簡易リアクションを提供する。

[Suggestion] Work作成時にスレッドを自動生成し、未投稿のスレッドは一覧で非表示（または折りたたみ）にする。
[Suggestion] スレッド検索に「未投稿も含める」トグルを設け、必要時のみ未投稿スレッドを表示できること。
[Suggestion] Work詳細から「チャットを開く」導線を提供し、未表示スレッドでも直接遷移できること。

#### 4.10.1 追加検討事項

- [Open Question] systemメッセージの生成主体と投稿制限（サーバのみ/管理者のみ）
- [Open Question] chat_members.role の値域（owner/moderator/member など）
- [Open Question] 既読/未読の表示単位（スレッド/メッセージ）
- [Risk] 保存期間1年の根拠（法務/監査要件）の確認が必要

---

### 4.11 権限モデル（Work中心）

権限は「人 × Work」を基準に定義し、プロジェクト/システムは補助情報として扱うこと。  
役職・部署で固定化せず、横断業務を前提としたアクセス制御を採用すること。

権限は以下の3レイヤで構成すること。

| レイヤ | 概要 | 例 |
|------|------|------|
| システム権限（Role） | 役割ごとの機能範囲を定義 | ゲスト / パートナー / 担当 / リーダー / マネージャー / ディレクター / 管理者 |
| データ権限（Scope） | どのWorkが見えるか | 自分のWork / 関与システムのWork / 全体 |
| 操作権限（Action） | 何ができるか | 閲覧 / 作成 / 更新 / 完了 / 管理 |

「見える」と「操作できる」を分離し、誤操作と過剰な権限付与を防止すること。

#### 4.11.1 追加検討事項

- [Open Question] 関与システムの定義（所属/フォロー/参加のどれを採用するか）
- [Assumption] Roleは「ゲスト / パートナー / 担当 / リーダー / マネージャー / ディレクター / 管理者」に限定する
- [Risk] Scope設計が曖昧な場合、可視範囲が属人化する可能性

---

### 4.12 AI利用UX（明示実行）

AIは利用者の判断・作業を補助する存在とし、自動処理や自動完了は行わないこと。  
AI機能は以下の画面に限定して提供すること。

1) Work作成・編集（入力補助）  
2) Work詳細（要約・状況把握）  
3) 一覧・分析（気づき提供）

AI実行は必ずユーザー操作による明示的トリガーとし、結果は可視化・修正・破棄できること。  
AIはユーザーが閲覧可能な範囲のデータのみを使用し、個人評価・査定目的には利用しないこと。

#### 4.12.1 追加検討事項

- [Open Question] AI要約の表示粒度（段落/箇条書き/テンプレ別）
- [Risk] 自動提案の品質低下がUX悪化につながる可能性

---

### 4.13 管理業務

管理者がシステム運用に必要なマスタと設定を管理できること。  
管理業務の操作は監査ログに記録し、編集権限は管理者ロールに限定すること。  
設定変更は履歴を保持し、差分表示ができること。

#### 4.13.1 マスタ管理機能

以下のマスタを必須とすること：ユーザー、会社、拠点、部門、ロール、リソース、パーミッション、タグ、カテゴリ、Work分類、Work対象。  
マスタは一覧/検索/登録/編集/削除に対応すること。  
参照先が存在するマスタは削除ではなく無効化（アーカイブ）を優先できること。  
マスタ変更時に影響範囲（関連Work/記事）を表示できること。  
CSV等による一括登録/更新に対応できること。

#### 4.13.2 追加検討事項

- [Open Question] Work分類・対象マスタの管理権限（全社/組織単位）
- [Risk] マスタ変更によるWork分類の履歴保持方針が未定義

---

## 5. MVP方針（最小構成）

MVPは「Work中心設計が現場で回ること」を証明する最小構成とする。

### 5.1 MUST
- Work管理（作成・一覧・完了）
- ToolTemplate（定義駆動）
- 担当者別「今日のWork」
- System/Projectを対象として紐づけ
- WorkLog（開始・完了）

### 5.2 SHOULD
- コメント機能（最低限）
- 簡易フィルタ（担当・対象）
- AI要約（Work詳細のみ）

### 5.3 NOT NOW
- 高度な分析ダッシュボード
- 工数レポートの細かな集計
- 評価・査定系指標
- WebSocket/リアルタイム
- 複雑な承認フロー
- テンプレートのバージョン管理

---

## 6. リスクと対策（要件レベル）

- [Risk] Workが抽象的すぎて利用者が迷う可能性  
  [Suggestion] ToolTemplateを事前整備し、テンプレート選択でWork作成できる導線を用意する
- [Risk] form_schemaの自由度が高く品質が揺れる可能性  
  [Suggestion] テンプレート設計ガイドラインと命名規則を定義する
- [Risk] 操作ログによる工数推定の精度が業務によりばらつく可能性  
  [Assumption] 精度より継続性を優先し、分析は参考値として扱う
- [Risk] 稼働データが評価目的に使われる不安で入力が減る可能性  
  [Assumption] 本システムは評価・査定用途に使用しない方針を明文化する

---

## 7. 導入ステップ（概略）

一括移行は行わず、PoC → 限定運用 → 段階的本番移行の順で進める。  
既存業務を止めないことを最優先とする。

1) PoC（概念検証）  
2) 限定運用（パイロット導入）  
3) 段階的本番移行  
4) 本番定着・改善
