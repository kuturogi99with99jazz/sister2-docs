erDiagram
  companies ||--o{ branches : has
  branches ||--o{ divisions : has
  companies ||--o{ users : has
  users ||--o{ user_profiles : has

  users ||--o{ user_roles : assigned
  roles ||--o{ user_roles : includes
  roles ||--o{ role_permissions : grants
  permissions ||--o{ role_permissions : listed
  permissions ||--o{ permission_resources : targets
  resources ||--o{ permission_resources : listed

  work_types ||--o{ works : defines
  work_time_types ||--o{ works : defines
  users ||--o{ works : creates
  works ||--o{ work_assignees : assigns
  users ||--o{ work_assignees : assigned
  works ||--o{ work_activity_logs : logs
  users ||--o{ work_activity_logs : acts
  works ||--o{ work_tag_links : tagged
  work_tags ||--o{ work_tag_links : tag

  screen_routes ||--o{ screen_feedbacks : targets
  users ||--o{ screen_feedbacks : rates
  screen_feedback_templates ||--o{ screen_feedbacks : templates
  screen_feedbacks ||--o{ screen_feedback_logs : logs
  users ||--o{ screen_feedback_logs : records

  work_targets ||--o{ work_target_links : links
  works ||--o{ work_target_links : links
  users ||--o{ work_targets : owns

  blog_posts ||--o{ blog_post_tags : tagged
  blog_tags ||--o{ blog_post_tags : tag
  blog_posts ||--o{ blog_post_categories : categorized
  blog_categories ||--o{ blog_post_categories : category
  blog_posts ||--o{ blog_work_links : links
  works ||--o{ blog_work_links : linked
  blog_posts ||--o{ blog_target_links : links
  work_targets ||--o{ blog_target_links : linked

  users ||--o{ audit_logs : actions
  users ||--o{ system_settings : updates
  users ||--o{ company_settings : updates
  companies ||--o{ company_settings : has

  chat_threads ||--o{ chat_messages : has
  chat_threads ||--o{ chat_members : has
  users ||--o{ chat_members : joins
  users ||--o{ chat_reads : reads
  chat_threads ||--o{ chat_reads : tracks
  chat_messages ||--o{ chat_attachments : attaches
  users ||--o{ chat_attachments : uploads

  %% internal_tools = ToolTemplate
  internal_tools ||--o{ tool_definitions : defines
  internal_tools ||--o{ tool_entries : accepts
  tool_entries ||--o{ tool_entry_approvals : has
  users ||--o{ tool_entry_approvals : approves
  tool_entries ||--o{ tool_attachments : attaches
  users ||--o{ tool_entries : submits
  users ||--o{ internal_tools : owns
  tool_definitions ||--o{ works : templates

  companies {
    string id
    string name
    string status
    string created_at
    string updated_at
  }
  branches {
    string id
    string company_id
    string name
    string status
    string created_at
    string updated_at
  }
  divisions {
    string id
    string branch_id
    string name
    string status
    string created_at
    string updated_at
  }
  users {
    string id
    string company_id
    string email
    string status
    string created_at
    string last_login_at
  }
  user_profiles {
    string id
    string user_id
    string display_name
    string avatar_url
    string timezone
  }
  roles {
    string id
    string name
    string description
  }
  permissions {
    string id
    string name
    string description
  }
  resources {
    string id
    string name
    string description
  }
  user_roles {
    string id
    string user_id
    string role_id
  }
  role_permissions {
    string id
    string role_id
    string permission_id
  }
  permission_resources {
    string id
    string permission_id
    string resource_id
  }
  work_types {
    string id
    string name
  }
  work_time_types {
    string id
    string name
  }
  works {
    string id
    string created_by
    string work_type_id
    string work_time_type_id
    string template_id
    string title
    string content
    string form_data_json
    string status
    string start_date_planned
    string end_date_planned
    string start_date_actual
    string end_date_actual
    string created_at
    string updated_at
  }
  work_assignees {
    string id
    string work_id
    string user_id
    boolean is_primary
  }
  work_activity_logs {
    string id
    string work_id
    string user_id
    string action
    string meta_json
    string created_at
  }
  work_tags {
    string id
    string name
  }
  work_tag_links {
    string id
    string work_id
    string tag_id
  }
  screen_routes {
    string id
    string route_path
    string name
    string description
    string is_active
    string created_at
    string updated_at
  }
  screen_feedback_templates {
    string id
    string label
    string is_active
    string created_at
    string updated_at
  }
  screen_feedbacks {
    string id
    string screen_route_id
    string user_id
    string rating
    string reason
    string template_id
    string created_at
    string updated_at
  }
  screen_feedback_logs {
    string id
    string feedback_id
    string user_id
    string action
    string before_json
    string after_json
    string created_at
  }
  work_targets {
    string id
    string target_type
    string name
    string description
    string owner_user_id
    string status
    string created_at
    string updated_at
  }
  work_target_links {
    string id
    string work_id
    string target_id
  }
  blog_posts {
    string id
    string author_user_id
    string title
    string status
    string published_at
  }
  blog_tags {
    string id
    string name
  }
  blog_categories {
    string id
    string name
  }
  blog_post_tags {
    string id
    string post_id
    string tag_id
  }
  blog_post_categories {
    string id
    string post_id
    string category_id
  }
  blog_work_links {
    string id
    string post_id
    string work_id
  }
  blog_target_links {
    string id
    string post_id
    string target_id
  }
  audit_logs {
    string id
    string user_id
    string action
    string resource_type
    string resource_id
    string created_at
  }
  system_settings {
    string id
    string key
    string value_json
    string is_active
    string updated_by
    string updated_at
  }
  company_settings {
    string id
    string company_id
    string key
    string value_json
    string is_active
    string updated_by
    string updated_at
  }
  %% message_type: text | system | file
  chat_threads {
    string id
    string scope_type
    string scope_id
    string title
    string created_by
    string created_at
  }
  chat_messages {
    string id
    string chat_id
    string sender_user_id
    string content
    string message_type
    string parent_message_id
    string created_at
  }
  chat_members {
    string id
    string chat_id
    string user_id
    string role
    string joined_at
  }
  chat_reads {
    string id
    string chat_id
    string user_id
    string last_read_message_id
    string last_read_at
  }
  chat_attachments {
    string id
    string message_id
    string uploaded_by
    string file_key
    string file_name
    string content_type
    string size_bytes
  }
  internal_tools {
    string id
    string owner_user_id
    string name
    string type
    string status
    string created_at
    string updated_at
  }
  tool_definitions {
    string id
    string tool_id
    string definition_json
    string version
    string created_at
  }
  tool_entries {
    string id
    string tool_id
    string submitter_user_id
    string status
    string payload_json
    string created_at
    string updated_at
  }
  tool_entry_approvals {
    string id
    string entry_id
    string approver_user_id
    string step
    string status
    string comment
    string created_at
  }
  tool_attachments {
    string id
    string entry_id
    string uploaded_by
    string file_key
    string file_name
    string content_type
    string size_bytes
  }
