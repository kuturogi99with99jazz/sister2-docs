erDiagram
  companies ||--o{ branches : has
  branches ||--o{ divisions : has
  companies ||--o{ users : has
  users ||--o{ user_profiles : has

  users ||--o{ user_roles : assigned
  roles ||--o{ user_roles : includes
  roles ||--o{ role_permissions : grants
  permissions ||--o{ role_permissions : listed
  permissions ||--o{ permission_resources : targets
  resources ||--o{ permission_resources : listed

  work_types ||--o{ works : defines
  work_time_types ||--o{ works : defines
  users ||--o{ works : creates
  works ||--o{ work_assignees : assigns
  users ||--o{ work_assignees : assigned
  works ||--o{ work_activity_logs : logs
  users ||--o{ work_activity_logs : acts
  works ||--o{ work_tag_links : tagged
  work_tags ||--o{ work_tag_links : tag
  users ||--o{ announcements : creates
  announcements ||--o{ announcement_targets : targets
  announcements ||--o{ announcement_reads : reads
  users ||--o{ announcement_reads : dismisses

  screen_routes ||--o{ screen_feedbacks : targets
  users ||--o{ screen_feedbacks : rates
  screen_feedback_templates ||--o{ screen_feedbacks : templates
  screen_feedbacks ||--o{ screen_feedback_logs : logs
  users ||--o{ screen_feedback_logs : records

  report_templates ||--o{ report_template_roles : grants
  roles ||--o{ report_template_roles : allowed
  report_templates ||--o{ report_runs : generates
  users ||--o{ report_runs : triggers
  report_runs ||--o{ report_run_files : outputs
  report_templates ||--o{ report_schedules : schedules
  users ||--o{ report_templates : defines

  work_targets ||--o{ work_target_links : links
  works ||--o{ work_target_links : links
  users ||--o{ work_targets : owns

  blog_posts ||--o{ blog_post_tags : tagged
  blog_tags ||--o{ blog_post_tags : tag
  blog_posts ||--o{ blog_post_categories : categorized
  blog_categories ||--o{ blog_post_categories : category
  blog_posts ||--o{ blog_work_links : links
  works ||--o{ blog_work_links : linked
  blog_posts ||--o{ blog_target_links : links
  work_targets ||--o{ blog_target_links : linked

  users ||--o{ audit_logs : actions
  users ||--o{ system_settings : updates
  users ||--o{ company_settings : updates
  companies ||--o{ company_settings : has

  chat_threads ||--o{ chat_messages : has
  chat_threads ||--o{ chat_members : has
  users ||--o{ chat_members : joins
  users ||--o{ chat_reads : reads
  chat_threads ||--o{ chat_reads : tracks
  chat_messages ||--o{ chat_attachments : attaches
  users ||--o{ chat_attachments : uploads

  %% internal_tools = ToolTemplate
  internal_tools ||--o{ tool_definitions : defines
  internal_tools ||--o{ tool_entries : accepts
  tool_entries ||--o{ tool_entry_approvals : has
  users ||--o{ tool_entry_approvals : approves
  tool_entries ||--o{ tool_attachments : attaches
  users ||--o{ tool_entries : submits
  users ||--o{ internal_tools : owns
  tool_definitions ||--o{ works : templates

  companies {
    uuid id
    text name
    varchar status
    timestamptz created_at
    timestamptz updated_at
  }
  branches {
    uuid id
    uuid company_id
    text name
    varchar status
    timestamptz created_at
    timestamptz updated_at
  }
  divisions {
    uuid id
    uuid branch_id
    text name
    varchar status
    timestamptz created_at
    timestamptz updated_at
  }
  users {
    uuid id
    uuid company_id
    text email
    varchar status
    timestamptz created_at
    timestamptz last_login_at
  }
  user_profiles {
    uuid id
    uuid user_id
    text display_name
    text avatar_url
    text timezone
  }
  roles {
    uuid id
    text name
    text description
  }
  permissions {
    uuid id
    text name
    text description
  }
  resources {
    uuid id
    text name
    text description
  }
  user_roles {
    uuid id
    uuid user_id
    uuid role_id
  }
  role_permissions {
    uuid id
    uuid role_id
    uuid permission_id
  }
  permission_resources {
    uuid id
    uuid permission_id
    uuid resource_id
  }
  work_types {
    uuid id
    text name
  }
  work_time_types {
    uuid id
    text name
  }
  works {
    uuid id
    uuid created_by
    uuid work_type_id
    uuid work_time_type_id
    uuid template_id
    text title
    text content
    jsonb form_data_json
    varchar status
    date start_date_planned
    date end_date_planned
    date start_date_actual
    date end_date_actual
    timestamptz created_at
    timestamptz updated_at
  }
  work_assignees {
    uuid id
    uuid work_id
    uuid user_id
    boolean is_primary
  }
  work_activity_logs {
    uuid id
    uuid work_id
    uuid user_id
    varchar action
    jsonb meta_json
    timestamptz created_at
  }
  work_tags {
    uuid id
    text name
  }
  work_tag_links {
    uuid id
    uuid work_id
    uuid tag_id
  }
  announcements {
    uuid id
    text title
    text body
    text link_url
    varchar priority
    timestamptz start_at
    timestamptz end_at
    uuid created_by
    timestamptz created_at
    timestamptz updated_at
  }
  announcement_targets {
    uuid id
    uuid announcement_id
    varchar target_scope
    uuid target_id
  }
  announcement_reads {
    uuid id
    uuid announcement_id
    uuid user_id
    timestamptz dismissed_at
  }
  screen_routes {
    uuid id
    text route_path
    text name
    text description
    boolean is_active
    timestamptz created_at
    timestamptz updated_at
  }
  screen_feedback_templates {
    uuid id
    text label
    boolean is_active
    timestamptz created_at
    timestamptz updated_at
  }
  screen_feedbacks {
    uuid id
    uuid screen_route_id
    uuid user_id
    varchar rating
    text reason
    uuid template_id
    timestamptz created_at
    timestamptz updated_at
  }
  screen_feedback_logs {
    uuid id
    uuid feedback_id
    uuid user_id
    varchar action
    jsonb before_json
    jsonb after_json
    timestamptz created_at
  }
  report_templates {
    uuid id
    text name
    varchar report_type
    text[] output_formats
    text template_file_key
    text template_file_name
    int retention_days
    boolean is_immutable
    varchar status
    uuid created_by
    timestamptz created_at
    timestamptz updated_at
  }
  report_template_roles {
    uuid id
    uuid report_template_id
    uuid role_id
    varchar access_type
  }
  report_runs {
    uuid id
    uuid report_template_id
    uuid triggered_by
    varchar trigger_type
    jsonb parameters_json
    varchar status
    timestamptz started_at
    timestamptz finished_at
    timestamptz created_at
  }
  report_run_files {
    uuid id
    uuid report_run_id
    text file_key
    text file_name
    text content_type
    bigint size_bytes
    timestamptz created_at
  }
  report_schedules {
    uuid id
    uuid report_template_id
    text cron
    text timezone
    boolean is_active
    timestamptz last_run_at
    timestamptz next_run_at
    timestamptz created_at
    timestamptz updated_at
  }
  work_targets {
    uuid id
    varchar target_type
    text name
    text description
    uuid owner_user_id
    varchar status
    timestamptz created_at
    timestamptz updated_at
  }
  work_target_links {
    uuid id
    uuid work_id
    uuid target_id
  }
  blog_posts {
    uuid id
    uuid author_user_id
    text title
    varchar status
    timestamptz published_at
  }
  blog_tags {
    uuid id
    text name
  }
  blog_categories {
    uuid id
    text name
  }
  blog_post_tags {
    uuid id
    uuid post_id
    uuid tag_id
  }
  blog_post_categories {
    uuid id
    uuid post_id
    uuid category_id
  }
  blog_work_links {
    uuid id
    uuid post_id
    uuid work_id
  }
  blog_target_links {
    uuid id
    uuid post_id
    uuid target_id
  }
  audit_logs {
    uuid id
    uuid user_id
    varchar action
    varchar resource_type
    uuid resource_id
    timestamptz created_at
  }
  system_settings {
    uuid id
    varchar key
    jsonb value_json
    boolean is_active
    uuid updated_by
    timestamptz updated_at
  }
  company_settings {
    uuid id
    uuid company_id
    varchar key
    jsonb value_json
    boolean is_active
    uuid updated_by
    timestamptz updated_at
  }
  %% message_type: text | system | file
  chat_threads {
    uuid id
    varchar scope_type
    uuid scope_id
    text title
    uuid created_by
    timestamptz created_at
  }
  chat_messages {
    uuid id
    uuid chat_id
    uuid sender_user_id
    text content
    varchar message_type
    uuid parent_message_id
    timestamptz created_at
  }
  chat_members {
    uuid id
    uuid chat_id
    uuid user_id
    varchar role
    timestamptz joined_at
  }
  chat_reads {
    uuid id
    uuid chat_id
    uuid user_id
    uuid last_read_message_id
    timestamptz last_read_at
  }
  chat_attachments {
    uuid id
    uuid message_id
    uuid uploaded_by
    text file_key
    text file_name
    text content_type
    bigint size_bytes
  }
  internal_tools {
    uuid id
    uuid owner_user_id
    text name
    varchar type
    varchar status
    timestamptz created_at
    timestamptz updated_at
  }
  tool_definitions {
    uuid id
    uuid tool_id
    jsonb definition_json
    varchar version
    timestamptz created_at
  }
  tool_entries {
    uuid id
    uuid tool_id
    uuid submitter_user_id
    varchar status
    jsonb payload_json
    timestamptz created_at
    timestamptz updated_at
  }
  tool_entry_approvals {
    uuid id
    uuid entry_id
    uuid approver_user_id
    int step
    varchar status
    text comment
    timestamptz created_at
  }
  tool_attachments {
    uuid id
    uuid entry_id
    uuid uploaded_by
    text file_key
    text file_name
    text content_type
    bigint size_bytes
  }
